<!-- source chloropleth: https://bl.ocks.org/denisemauldin/3436a3ae06f73a492228059a515821fe -->
<!-- source arrowmap: http://bl.ocks.org/Andrew-Reid/8de4b9d0d0a87a478770e0cc86e2f5e4 -->

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Chloropleth map</title>

    <!-- stylesheets -->
    <link rel="stylesheet" href="css/map.css">

    <!-- js libraries -->
    <script src="libs/d3.v5.min.js"></script>
    <script src="libs/topojson.v2.min.js"></script>
</head>

<body>
    <script>
        // Global variables used in all of the scripts
        var studentDirection = "incoming";
        var selectedCountry = "none";

        // The event names
        var dispatch = d3.dispatch("stateHoverEvent", "stateSelectedEvent", "studentDirectionEvent");

        // HOVER
        dispatch.on("stateHoverEvent", function(state){
            alert(state);
        });

        // STATE SELECTED
        dispatch.on("stateSelectedEvent", function(numericID){
            // Check if it is a number
            assert(!isNaN(numericID));

            selectedCountry = numericID;

            // Draw the lines if the selected state is not null
            if (numericID === "000") {
                clearLines();
                document.getElementById("dropdown_country").value = "none";
            } else {
                drawLines(selectedCountry);
                document.getElementById("dropdown_country").value = countryData.get(numericID).country.toLowerCase();
            }
        });

        // DIRECTION SELECTED
        dispatch.on("studentDirectionEvent", function(direction) {
            studentDirection = direction;

            // Set the dropdown menu
            document.getElementById("dropdown_direction").value = direction;

            // Update or draw lines only if a country is selected
            if (selectedCountry !== "000") {
                clearLines();
                drawLines(selectedCountry);
            }
        });
    </script>

    <div id="student_direction" style="display: inline-block">
        student direction:
        <script>
            function changedDropdownDirection() {
                // Direction changed
                let dropdown = document.getElementById("dropdown_direction");
                dispatch.call('studentDirectionEvent', dropdown.value, dropdown.value);
            }
        </script>
        <select id="dropdown_direction" onchange="changedDropdownDirection()">
            <option value="incoming">Incoming</option>
            <option value="outgoing">Outgoing</option>
        </select>
    </div>

    <div id="selected_country" style="display: inline-block">
        selected country:
        <script>
            function changedDropdownCountry() {
                let dropdown = document.getElementById("dropdown_country");
                let dropdownVal = dropdown.value.toUpperCase();

                let numeric = "";
                if (dropdownVal === "none") {
                    numeric = "000"
                } else {
                    numeric = codeToNumeric.get(dropdownVal);
                }
                dispatch.call('stateSelectedEvent', numeric, numeric);
            }
        </script>
        <select id="dropdown_country" onchange="changedDropdownCountry()">
            <option value="none">none</option>
        </select>
    </div>

    <div id="map" style="max-width: 60%; height: 400px">
       <svg width="100%" height="100%">
           <!-- the map -->
       </svg>
    </div>
    <script src="js/map.js"></script>
</body>
</html>


